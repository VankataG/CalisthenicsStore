@using Microsoft.AspNetCore.Mvc.TagHelpers
@model CalisthenicsStore.ViewModels.Order.ProfileOrderViewModel
@{
    ViewData["Title"] = "Order Details";
    string StatusClass(string s) => (s ?? "").ToLower() switch
    {
        "pending" => "badge warn",
        "processing" => "badge warn",
        "shipped" => "badge info",
        "delivered" => "badge ok",
        "completed" => "badge ok",
        "cancelled" => "badge err",
        "failed" => "badge err",
        _ => "badge"
    };
    string Money(decimal v) => v.ToString("C");
    var subtotal = Model.Products?.Sum(p => p.Quantity * p.Price) ?? 0m;
    string ShortId = Model.Id.ToString("N")[..8].ToUpperInvariant();
}

<style>
    :root {
        --bg: #0e0f12;
        --panel: #14161c;
        --panel2: #191c22;
        --text: #e7e9ee;
        --muted: #9aa3b2;
        --ok: #22c55e;
        --warn: #f59e0b;
        --err: #ef4444;
        --ring: 0 0 0 .12rem rgba(76,141,255,.45);
        --radius: 18px;
        --shadow: 0 8px 30px rgba(0,0,0,.45)
    }

    * {
        box-sizing: border-box
    }

    body {
        color: var(--text)
    }

    .wrap {
        max-width: 1100px;
        margin: 32px auto;
        padding: 0 20px
    }

    .card {
        background: linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
        border: 1px solid #232733;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 22px;
        border-bottom: 1px solid #232733
    }

    .h-left {
        display: flex;
        gap: 10px;
        align-items: center
    }

    .h-id {
        font-family: ui-monospace,Consolas,Menlo,monospace
    }

    .badge {
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
        border: 1px solid #2a3142;
        background: #121620;
        color: #c9d1e4
    }

        .badge.ok {
            border-color: #1d3a28;
            background: #112017;
            color: #b8f3cd
        }

        .badge.warn {
            border-color: #3a2f1d;
            background: #201a11;
            color: #ffd99a
        }

        .badge.err {
            border-color: #3a1d1d;
            background: #211111;
            color: #ffb1b1
        }

        .badge.info {
            border-color: #20304a;
            background: #0f1726;
            color: #c6dcff
        }

    .grid {
        display: grid;
        gap: 18px;
        padding: 20px;
        grid-template-columns: 2fr 1fr
    }
    @@media (max-width:900px) {
        .grid

    {
        grid-template-columns: 1fr
    }

    }

    .panel {
        padding: 18px;
        border: 1px solid #232733;
        border-radius: 14px;
        background: #141821
    }

        .panel h3 {
            margin: 0 0 10px;
            font-size: 16px;
            color: #d6dae6
        }

    .kv {
        display: grid;
        grid-template-columns: 140px 1fr;
        gap: 8px 14px
    }

        .kv .k {
            color: var(--muted)
        }

    .table {
        width: 100%;
        border-collapse: collapse
    }

        .table th, .table td {
            padding: .65rem;
            border-top: 1px solid #1f2431
        }

        .table thead th {
            font-weight: 600;
            color: #cfd5e6;
            background: #0f1320;
            border-top: none
        }

        .table .num {
            text-align: right;
            white-space: nowrap
        }

    .row-product {
        display: flex;
        align-items: center;
        gap: .5rem
    }

        .row-product img {
            width: 36px;
            height: 36px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #1f2431
        }

    .footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 22px;
        border-top: 1px solid #232733
    }

    .btn {
        appearance: none;
        border: 1px solid #2a3142;
        color: var(--text);
        background: #1a1e27;
        padding: 10px 14px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none
    }

        .btn:hover {
            border-color: #3b4357
        }

        .btn.primary {
            background: linear-gradient(180deg,#366bff,#2e5ae6);
            border-color: #2e5ae6
        }

    .muted {
        color: var(--muted)
    }
</style>

<div class="wrap">
    <div class="card">
        <div class="header">
            <div class="h-left">
                <div class="badge">Order <span class="h-id">#@ShortId</span></div>
                <div class="@StatusClass(Model.Status)">@Model.Status</div>
                <div class="badge">@Model.OrderDate.ToString("dd MMM yyyy")</div>
            </div>
            <div class="h-right">
                @*<a asp-area="Admin" asp-controller="OrderManagement" asp-action="Index" class="btn">Back to list</a>*@
                @* Optional: add Edit/Change Status later *@
            </div>
        </div>

        <div class="grid">
            <div class="panel">
                <h3>Items</h3>
                @if (Model.Products?.Any() == true)
                {
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th class="num">Qty</th>
                                <th class="num">Price</th>
                                <th class="num">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Products)
                            {
                                var line = item.Quantity * item.Price;
                                <tr>
                                    <td>
                                        <div class="row-product">
                                            @if (!string.IsNullOrWhiteSpace(item.ImageUrl))
                                            {
                                                <img src="@item.ImageUrl" alt="@item.Name" />
                                            }
                                            <div>
                                                <div>@item.Name</div>
                                                <div class="muted">ID: @item.ProductId</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="num">@item.Quantity</td>
                                    <td class="num">@Money(item.Price)</td>
                                    <td class="num">@Money(line)</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="num"><strong>Order total</strong></td>
                                <td class="num"><strong>@Money(subtotal)</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                }
                else
                {
                    <div class="muted">No products in this order.</div>
                }
            </div>

            <div class="panel">
                <h3>Order info</h3>
                <div class="kv">
                    <div class="k">Order ID</div><div>@Model.Id</div>
                    <div class="k">User ID</div><div>@Model.ApplicationUserId</div>
                    <div class="k">Status</div><div><span class="@StatusClass(Model.Status)">@Model.Status</span></div>
                    <div class="k">Date</div><div>@Model.OrderDate.ToString("f")</div>
                </div>

                <h3 style="margin-top:16px;">Shipping</h3>
                <div class="kv">
                    <div class="k">Address</div><div>@Model.Address</div>
                    <div class="k">City</div><div>@Model.City</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="muted">Admin • Order details</div>
            <div style="display:flex;gap:10px;">
                <a asp-area="Admin" asp-controller="OrderManagement" asp-action="Index" class="btn">Back</a>
                @* Example future action:
           <a asp-area="Admin" asp-controller="Orders" asp-action="Edit" asp-route-id="@Model.Id" class="btn primary">Edit</a>
        *@
            </div>
        </div>
    </div>
</div>